<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pizza!</title>
</head>
  <script src="pixi.min.js"></script>
<body>

<style>* {
    padding: 0; margin: 0;
}
</style>

  <script type="text/javascript">
    let app = new PIXI.Application({ 
        width: 800,        
        height: 600,        
        antialias: true,    
        transparent: false, 
        resolution: 1       
  }
);

//Add the canvas
document.body.appendChild(app.view);

//Renderer
app.renderer.backgroundColor = 0xf48f42;
app.renderer.view.style.position = "absolute";
app.renderer.view.style.display = "block";
app.renderer.autoResize = true;
app.renderer.resize(window.innerWidth, window.innerHeight);

cursor = "url('sprites/pizza.png'),auto";
app.renderer.plugins.interaction.cursorStyles.default = cursor;



//Sprite loader
PIXI.loader
  .add("sprites/VodKabelovre.png")
  .add("sprites/beet.png")
  .load(setup);


//Global vars
var largeText = new PIXI.TextStyle({
    fontFamily: 'Arial',
    fontSize: 50,
})

var message = new PIXI.Text('Pakene!');
app.stage.addChild(message);

var fps = new PIXI.Text('fps ='+app.ticker.FPS);
app.stage.addChild(fps);
fps.x = 800;

var s = 0;
var score = new PIXI.Text('Score: '+s);  
score.x = 400;
app.stage.addChild(score);

var double = new PIXI.Text(' ', largeText);
double.x = 200;
double.y = 50;
app.stage.addChild(double);

var beet = [];


//Setup function
function setup() {
    
    let head = new PIXI.Sprite(PIXI.loader.resources["sprites/VodKabelovre.png"].texture);
    app.stage.addChild(head);
    head.interactive = true;
    head.hitArea = new PIXI.Circle (10,10, 10);

    //Create beets
    for (i = 0; i < 30; i++) {
    beet[i] = new PIXI.Sprite(PIXI.loader.resources["sprites/beet.png"].texture);
    beet[i].position.set(1000, 1000);
    app.stage.addChild(beet[i]);
    }

    for (let i = 0; i < 30; i++) {
    (function (x) {
      setTimeout(function() {
    beet[i].position.set(Math.floor(Math.random() * 800), Math.floor(Math.random() * 800));
    }, i* 2000 );
    })(i);
    }

    


//Mouse follow physics
const getMousePosition = () => {
    return app.renderer.plugins.interaction.mouse.global
};

let xVel = 0.1;
let yVel = 0.1;
let mousePosition = getMousePosition();
let speed = 2;
let angle = 45;

app.ticker.add(()=>{


    mousePosition = getMousePosition();
    let headX = mousePosition.x - head.x;
    let headY = mousePosition.y - head.y;
    angle = Math.atan2(headY, headX);
    xVel = Math.cos(angle) * speed;
    yVel = Math.sin(angle) * speed;
    head.x += xVel;
    head.y += yVel;

    checkCollision();

    
});


function checkCollision () {
    for (var i = 0; i < 30; i++) {
      if (collision(head, beet[i])) {
      s++;
      double.visible=false;
        if (i == 9 || i == 19) {
          s=s*2;
          double.text = "10 in row! Score doubled";
          double.visible = true;
        }
        if (i == 29) {
          double.text = "You win!"
          double.visible = true;
          app.ticker.stop();
        }
      app.stage.removeChild(beet[i]);
      beet[i].x = 1000;
      beet[i].y = 1000; 
      score.text = "Score: "+s;
      speed += 0.5;
      console.log("BeetID: " +i);
      message.text = "Eat 30 beets!";
      }
    }
    head.mouseover = function (mousedata) {
      double.text = "You lost! Don't eat the pizza.";
      double.visible = true;
      app.ticker.stop();
    }
}


}
function collision(r1, r2) {

let hit, combinedHalfWidths, combinedHalfHeights, vx, vy;

hit = false;

r1.centerX = r1.x + r1.width / 2;
r1.centerY = r1.y + r1.height / 2;
r2.centerX = r2.x + r2.width / 2;
r2.centerY = r2.y + r2.height / 2;

r1.halfWidth = r1.width / 2;
r1.halfHeight = r1.height / 2;
r2.halfWidth = r2.width / 2;
r2.halfHeight = r2.height / 2;

vx = r1.centerX - r2.centerX;
vy = r1.centerY - r2.centerY;

combinedHalfWidths = r1.halfWidth + r2.halfWidth;
combinedHalfHeights = r1.halfHeight + r2.halfHeight;

if (Math.abs(vx) < combinedHalfWidths) {

  if (Math.abs(vy) < combinedHalfHeights) {

    hit = true;
  } else {

    hit = false;
  }
} else {

  hit = false;
}

return hit;
};

  </script>
</body>
</html>